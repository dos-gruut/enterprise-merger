image: ubuntu

stages:
  - build

build:
  stage: build
#  only: [merge-request]
  before_script:
    - apt-get update -y && apt-get upgrade -y
    - apt-get install -y python3 python3-pip clang-tidy clang-6.0 lld-6.0
    #  boost
    - apt-get install -y libboost1.65-all-dev
    - pip3 install cmake
  script:
    - mkdir -p build && cd build
    - cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DENABLE_CLANG_TIDY=ON -DCMAKE_CXX_COMPILER="clang++-6.0" ..
    - cp ../scripts/run-clang-tidy.py run-clang-tidy.py
    - pip3 install pyyaml
    - python3 run-clang-tidy.py > lint_output.txt
    - |
      if [[ -n $(grep "warning: " lint_output.txt) ]] || [[ -n $(grep "error: " lint_output.txt) ]]; then
        echo "You must pass the clang tidy checks before submitting a pull request"
        echo ""
        grep --color -E '^|warning: |error: ' lint_output.txt
        exit -1;
      else
        echo -e "\033[1;32m\xE2\x9C\x93 passed:\033[0m $1";
      fi
#    - make gruut_hana_merger